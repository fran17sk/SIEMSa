{% extends "informatica/home.html" %}

{% block head %}
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa;
        margin: 0;
    }

    .container {
        background-color: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
    }

    h2 {
        text-align: center;
        color: #343a40;
        margin-bottom: 30px;
    }

    .search-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 20px;
    }

    .search-bar {
        width: 100%;
        max-width: 350px;
        padding: 10px 15px;
        font-size: 15px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #f1f1f1;
    }

    .add-button {
        padding: 10px 18px;
        background-color: #007bff;
        color: #fff;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: background-color 0.2s;
        margin-top: 10px;
    }

    .add-button:hover {
        background-color: #0056b3;
    }

    table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-top: 20px;
    }

    th, td {
        padding: 12px 15px;
        text-align: left;
        vertical-align: top;
    }

    th {
        background-color: #f4f6f8;
        color: #495057;
        font-weight: 600;
        border-bottom: 2px solid #dee2e6;
    }

    tbody tr {
        border-bottom: 1px solid #e9ecef;
        transition: background-color 0.2s;
    }

    tbody tr:hover {
        background-color: #f1f3f5;
    }

    .empty-row {
        text-align: center;
        font-style: italic;
        color: #888;
        padding: 20px 0;
    }

    .edit-link {
        color: #007bff;
        font-weight: 500;
        text-decoration: none;
    }

    .edit-link:hover {
        text-decoration: underline;
    }

    @media (max-width: 768px) {
        .search-container {
            flex-direction: column;
            align-items: flex-start;
        }

        .add-button {
            width: 100%;
            text-align: center;
        }

        .search-bar {
            width: 100%;
            margin-bottom: 20px;
        }

        table, thead, tbody, th, td, tr {
            font-size: 14px;
        }
    }
    .btn-container{
        margin-top: 10px;
    }
    
</style>
{% endblock %}

{% block content %}
<div class="container" id="cards">

    <h2>Inventario Inform√°tico</h2>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-bar" placeholder="Buscar en cualquier campo...">
        <div class="button-group" >
            <button onclick="guardarPDF()" class="add-button" style="background-color: #6f42c1;">üìÑ Guardar PDF</button>
            <button onclick="imprimir()" class="add-button" style="background-color: #20c997;">üñ® Imprimir</button>
            <button onclick="exportarExcel()" class="add-button" style="background-color: #ffc107; color: #000;">üì• Exportar Excel</button>
        </div>
        <div class="btn-container">
            <a href="{% url 'inventario_create' %}" class="add-button">+ Registrar nuevo equipo</a>
            <a href="{% url 'importar_excel' %}" class="add-button" style="background-color: #17a2b8;">‚¨Ü Importar desde Excel</a>
        </div>

    </div>

    <table id="inventarioTable">
        <thead>
            <tr>
                <th>Equipo</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>N¬∞ Inventario</th>
                <th>N¬∞ Serie</th>
                <th>Estado</th>
                <th>Ubicaci√≥n / √Årea</th>
                <th>Observaciones</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% if inventarios %}
                {% for item in inventarios %}
                <tr>
                    <td>{{ item.equipo|default:"-" }}</td>
                    <td>{{ item.marca|default:"-" }}</td>
                    <td>{{ item.modelo|default:"-" }}</td>
                    <td>{{ item.numero_inventario|default:"-" }}</td>
                    <td>{{ item.numero_serie|default:"-" }}</td>
                    <td>{{ item.estado|default:"-" }}</td>
                    <td>{{ item.ubicacion|default:"-" }}</td>
                    <td>{{ item.observaciones|default:"-" }}</td>
                    <td><a href="{% url 'inventario_edit' item.id %}" class="edit-link">Editar</a></td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="9" class="empty-row">No hay registros de inventario.</td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>




{% endblock %}

{% block script %}
{% if messages %}
<script>
    
    console.log("{{ message.tags }}", "{{ message }}");

    document.addEventListener('DOMContentLoaded', function () {
        {% for message in messages %}
            Swal.fire({
                toast: true,
                position: 'top-end',
                icon: '{% if "error" in message.tags %}error{% elif "warning" in message.tags %}warning{% elif "success" in message.tags %}success{% else %}info{% endif %}',
                title: '{{ message|escapejs }}',
                showConfirmButton: false,
                timer: 5000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });
        {% endfor %}
    });
</script>
{% endif %}
<script>
    const searchInput = document.getElementById('searchInput');
    const rows = document.querySelectorAll('#inventarioTable tbody tr');

    searchInput.addEventListener('keyup', function () {
        const query = this.value.toLowerCase();
        rows.forEach(row => {
            const cells = Array.from(row.querySelectorAll('td'));
            const match = cells.some(cell => cell.textContent.toLowerCase().includes(query));
            row.style.display = match ? '' : 'none';
        });
    });
</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
    function exportarExcel() {
        const wb = XLSX.utils.book_new();
        const ws_data = [
            ["Equipo", "Marca", "Modelo", "N¬∞ Inventario", "N¬∞ Serie", "Estado", "Ubicaci√≥n / √Årea", "Observaciones"]
        ];

        document.querySelectorAll('#inventarioTable tbody tr').forEach(row => {
            if (row.style.display !== "none") {
                const fila = Array.from(row.querySelectorAll('td')).slice(0, 8).map(td => td.textContent.trim());
                ws_data.push(fila);
            }
        });

        const ws = XLSX.utils.aoa_to_sheet(ws_data);
        XLSX.utils.book_append_sheet(wb, ws, "Inventario");
        XLSX.writeFile(wb, "inventario_informatico.xlsx");
    }
    async function imprimir() {
        const contenido = document.getElementById('inventarioTable');
        const estilo = `
            <style>
                table {
                    width: 100%;
                    border-collapse: collapse;
                }
                th, td {
                    padding: 10px;
                    border: 1px solid #ccc;
                    text-align: left;
                }
                th {
                    background-color: #f0f0f0;
                }
            </style>
        `;

        const ventana = window.open('', '', 'width=1000,height=700');
        ventana.document.write('<html><head><title>Imprimir Inventario</title>');
        ventana.document.write(estilo);
        ventana.document.write('</head><body>');
        ventana.document.write('<h2>Inventario Inform√°tico</h2>');
        ventana.document.write(contenido.outerHTML);
        ventana.document.write('</body></html>');
        ventana.document.close();
        ventana.focus();
        ventana.print();
        ventana.close();
    }
    async function guardarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ orientation: 'landscape' });

        doc.setFontSize(16);
        doc.text("Inventario Inform√°tico", 14, 20);

        const headers = [["Equipo", "Marca", "Modelo", "N¬∞ Inventario", "N¬∞ Serie", "Estado", "Ubicaci√≥n", "Observaciones"]];
        const data = [];

        document.querySelectorAll('#inventarioTable tbody tr').forEach(row => {
            if (row.style.display !== "none") {
                const fila = Array.from(row.querySelectorAll('td')).slice(0, 8).map(td => td.textContent.trim());
                data.push(fila);
            }
        });

        doc.autoTable({
            startY: 30,
            head: headers,
            body: data,
            styles: { fontSize: 9 },
            theme: 'striped'
        });

        doc.save("inventario_informatico.pdf");
    }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>



{% endblock %}
